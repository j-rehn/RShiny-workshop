<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Jacqueline Rehn" />


<title>Building a Modular Shiny App</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">RShiny Workshop (COMBINE)</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="./gettingstarted.html">Getting Started</a>
</li>
<li>
  <a href="./workshop-overview.html">Introduction</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="./02_birthday_app.html">02 Birthday App</a>
    </li>
    <li>
      <a href="./03_shiny_reactivity.html">03 Reactivity</a>
    </li>
    <li>
      <a href="./04_interactive_outputs.html">04 Interactive Outputs</a>
    </li>
    <li>
      <a href="./05_shiny_modules.html">05 Shiny Modules</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Building a Modular Shiny App</h1>
<h4 class="author">Jacqueline Rehn</h4>

</div>


<div id="introduction-to-shiny-modules" class="section level1">
<h1>Introduction to Shiny Modules</h1>
<div id="what-are-modules" class="section level2">
<h2>What are Modules?</h2>
<p>Shiny Modules are a way to organize and structure Shiny applications
by encapsulating related UI and server logic into reusable,
self-contained components. Instead of writing all your app’s code in one
large file, modules allow you to break your app into smaller pieces—each
with its own user interface and server-side logic—that can be easily
reused within the same app or across multiple apps.</p>
<p>Learning about Shiny Modules is valuable because they help you:</p>
<ul>
<li>Avoid code duplication by reusing the same module in different
places (embracing the DRY—Don’t Repeat Yourself—principle).<br />
</li>
<li>Simplify complex apps by dividing them into manageable, isolated
parts, making your codebase easier to read, debug, and maintain.<br />
</li>
<li>Prevent input/output conflicts through automatic namespacing, so
each module’s controls are kept separate from others.<br />
</li>
<li>Scale up your apps more easily, since modules can be combined,
nested, and composed as your project grows.</li>
</ul>
<p>Learning about shiny modules is best done with an example. So let’s
do this by converting the <code>dgeVis</code> app from our last tutorial
into a modular design.</p>
</div>
</div>
<div id="building-our-modular-app-step-by-step" class="section level1">
<h1>Building Our Modular App Step by Step</h1>
<div id="step-1-plan-your-module-structure" class="section level2">
<h2>Step 1: Plan Your Module Structure</h2>
<p>For this app, each tab can be converted into its own module:</p>
<ul>
<li>Volcano Plot Module<br />
</li>
<li>Boxplot Module<br />
</li>
<li>Heatmap Module.</li>
</ul>
<p>This mirrors the current tab structure and keeps each analysis aspect
self-contained.</p>
</div>
<div id="step-2-create-module-files" class="section level2">
<h2>Step 2: Create Module Files</h2>
<p>Each module will be written into it’s own R script. To ensure Shiny
understands where it should locate module files create a directory
called <code>modular_app</code> and within that folder create a
subdirectory called <code>R</code>. Within the <code>R</code> directory
you will save all of the files for each module.</p>
<p>Organize your codebase by creating separate files for each
module:</p>
<ul>
<li>volcano_mod.R<br />
</li>
<li>boxplot_mod.R<br />
</li>
<li>heatmap_mod.R</li>
</ul>
<p>In this tutorial each file will contain both the UI and server
functions for that module.</p>
</div>
<div id="step-3-refactor-code-for-volcano-plot-into-a-module"
class="section level2">
<h2>Step 3: Refactor Code for Volcano Plot into a Module</h2>
<p>Below is a template for how to convert a tab of our initial
<code>dgeVis</code> app into a module.</p>
<p><strong>a. Volcano Plot Module
(<code>volcano_mod.R</code>)</strong></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># volcano_mod.R</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>volcano_ui <span class="ot">&lt;-</span> <span class="cf">function</span>(id) {</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  ns <span class="ot">&lt;-</span> <span class="fu">NS</span>(id)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  <span class="fu">tagList</span>(</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>    <span class="fu">selectInput</span>(<span class="fu">ns</span>(<span class="st">&quot;contrast&quot;</span>), <span class="st">&quot;Select a contrast:&quot;</span>, <span class="at">choices =</span> <span class="cn">NULL</span>),</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>    <span class="fu">plotOutput</span>(<span class="fu">ns</span>(<span class="st">&quot;volcanoPlot&quot;</span>)),</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>    <span class="fu">DTOutput</span>(<span class="fu">ns</span>(<span class="st">&quot;top_dge&quot;</span>))</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>  )</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>}</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>volcano_server <span class="ot">&lt;-</span> <span class="cf">function</span>(id, dge_results) {</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>  <span class="fu">moduleServer</span>(id, <span class="cf">function</span>(input, output, session) {</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>    <span class="fu">updateSelectInput</span>(session, <span class="st">&quot;contrast&quot;</span>, <span class="at">choices =</span> <span class="fu">names</span>(dge_results))</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>    </span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>    contrast <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>      <span class="fu">req</span>(input<span class="sc">$</span>contrast)</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>      dge_results[[input<span class="sc">$</span>contrast]]</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>    })</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>    </span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>    output<span class="sc">$</span>volcanoPlot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>      <span class="fu">contrast</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>        <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> logFC, </span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a>                   <span class="at">y =</span> <span class="sc">-</span><span class="fu">log10</span>(P.Value),</span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>                   <span class="at">colour =</span> DE,</span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a>                   <span class="at">text =</span> <span class="fu">paste</span>(<span class="st">&quot;Gene:&quot;</span>, SYMBOL, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a>                                <span class="st">&quot;EntrezID:&quot;</span>, ENTREZID, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a>                                <span class="st">&quot;Chr:&quot;</span>, TXCHROM, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))) <span class="sc">+</span></span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a>        <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a>        <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;grey&quot;</span>, <span class="st">&quot;red&quot;</span>), </span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a>                            <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">&quot;Down&quot;</span>, <span class="st">&quot;Not significant&quot;</span>, <span class="st">&quot;Up&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb1-32"><a href="#cb1-32" tabindex="-1"></a>        <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb1-33"><a href="#cb1-33" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb1-34"><a href="#cb1-34" tabindex="-1"></a>              <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb1-35"><a href="#cb1-35" tabindex="-1"></a>              <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>))</span>
<span id="cb1-36"><a href="#cb1-36" tabindex="-1"></a>    })</span>
<span id="cb1-37"><a href="#cb1-37" tabindex="-1"></a>    </span>
<span id="cb1-38"><a href="#cb1-38" tabindex="-1"></a>    output<span class="sc">$</span>top_dge <span class="ot">&lt;-</span> <span class="fu">renderDT</span>({</span>
<span id="cb1-39"><a href="#cb1-39" tabindex="-1"></a>      df <span class="ot">&lt;-</span> <span class="fu">filter</span>(<span class="fu">contrast</span>(), isSignificant <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-40"><a href="#cb1-40" tabindex="-1"></a>        <span class="fu">arrange</span>(adj.P.Val) <span class="sc">%&gt;%</span> </span>
<span id="cb1-41"><a href="#cb1-41" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(SYMBOL, TXCHROM, logFC, adj.P.Val, DE)</span>
<span id="cb1-42"><a href="#cb1-42" tabindex="-1"></a>    </span>
<span id="cb1-43"><a href="#cb1-43" tabindex="-1"></a>      <span class="co"># pass table to DT and supply parameters</span></span>
<span id="cb1-44"><a href="#cb1-44" tabindex="-1"></a>      <span class="fu">datatable</span>(df,</span>
<span id="cb1-45"><a href="#cb1-45" tabindex="-1"></a>                <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1-46"><a href="#cb1-46" tabindex="-1"></a>                <span class="at">filter =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb1-47"><a href="#cb1-47" tabindex="-1"></a>                <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb1-48"><a href="#cb1-48" tabindex="-1"></a>                  <span class="at">pageLength =</span> <span class="dv">10</span>,</span>
<span id="cb1-49"><a href="#cb1-49" tabindex="-1"></a>                  <span class="at">lengthChange =</span> <span class="cn">FALSE</span></span>
<span id="cb1-50"><a href="#cb1-50" tabindex="-1"></a>                ))</span>
<span id="cb1-51"><a href="#cb1-51" tabindex="-1"></a>    })</span>
<span id="cb1-52"><a href="#cb1-52" tabindex="-1"></a>     </span>
<span id="cb1-53"><a href="#cb1-53" tabindex="-1"></a>  })</span>
<span id="cb1-54"><a href="#cb1-54" tabindex="-1"></a>}</span></code></pre></div>
<p>Save the code for <code>volcano_mod.R</code> into an R script with
that name and ensure it is listed in the <code>R</code> directory of
<code>modular_app</code>.</p>
<p>Before moving on, let’s break down the differences between the module
and the code from the initial app:</p>
<p><strong>1. UI Function: <code>volcano_ui</code></strong></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>volcano_ui <span class="ot">&lt;-</span> <span class="cf">function</span>(id) {</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  ns <span class="ot">&lt;-</span> <span class="fu">NS</span>(id)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="fu">tagList</span>(</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>    <span class="fu">selectInput</span>(<span class="fu">ns</span>(<span class="st">&quot;contrast&quot;</span>), <span class="st">&quot;Select a contrast:&quot;</span>, <span class="at">choices =</span> <span class="cn">NULL</span>),</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>    <span class="fu">plotOutput</span>(<span class="fu">ns</span>(<span class="st">&quot;volcanoPlot&quot;</span>)),</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>    <span class="fu">DTOutput</span>(<span class="fu">ns</span>(<span class="st">&quot;top_dge&quot;</span>))</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>  )</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>}</span></code></pre></div>
<p>The modular approach separates the volcano plot into its own UI
function, encapsulated and namespaced for reuse and clarity.</p>
<ol style="list-style-type: decimal">
<li><code>volcano_ui &lt;- function(id) {...}</code></li>
</ol>
<ul>
<li>Defines a UI function for the volcano plot module, which takes a
single argument, <code>id</code>.<br />
</li>
<li><strong>Difference from single-instance:</strong> In a typical app,
you would not wrap your UI code in a function or require an id
parameter. In a module, this <code>id</code> is essential for
namespacing.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li><code>ns &lt;- NS(id)</code></li>
</ol>
<ul>
<li>Creates a namespacing function (<code>ns</code>) using the provided
<code>id</code>. This function will prefix all input and output IDs
within the module to ensure they are unique.<br />
</li>
<li><strong>Difference from single-instance:</strong> In a non-modular
app, you would use plain strings for input/output IDs (e.g.,
<code>"contrast"</code>). In a module, you must use
<code>ns("...")</code> to avoid ID collisions if the module is used more
than once.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li><code>tagList(...)</code></li>
</ol>
<ul>
<li>Begins a list of UI elements to be returned by the module.<br />
</li>
<li><strong>Difference from single-instance:</strong> Same as in a
single-instance app; tagList is commonly used to group UI elements.</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li><code>selectInput(ns("contrast"), "Select a contrast:", choices = NULL)</code></li>
</ol>
<ul>
<li>Adds a select input for choosing a contrast. The input ID is
namespaced using <code>ns("contrast")</code>, making it unique to this
module instance.<br />
</li>
<li><strong>Difference from single-instance:</strong> In a regular app,
you would write <code>selectInput("contrast", ...),</code> which could
conflict if used multiple times. Here, <code>ns("contrast")</code>
ensures uniqueness (e.g., <code>"volcano-contrast"</code> if
<code>id = "volcano"</code>).</li>
</ul>
<ol start="5" style="list-style-type: decimal">
<li><code>plotOutput(ns("volcanoPlot"))</code></li>
</ol>
<ul>
<li>Adds a plot output for the volcano plot. The output ID is
namespaced.<br />
</li>
<li><strong>Difference from single-instance:</strong> Normally, you’d
use <code>plotOutput("volcanoPlot")</code>. In a module,
<code>ns("volcanoPlot")</code> ensures this output is only referenced by
this module instance.</li>
</ul>
<ol start="6" style="list-style-type: decimal">
<li><code>DTOutput(ns("top_dge"))</code></li>
</ol>
<ul>
<li>Adds a DataTable output for displaying top differentially expressed
genes. The output ID is namespaced.<br />
</li>
<li><strong>Difference from single-instance:</strong> In a
single-instance app, <code>DTOutput("top_dge")</code> could clash with
other tables. Here, <code>ns("top_dge")</code> keeps it unique.</li>
</ul>
<p><br> <strong>Summary Table: Key UI Differences</strong></p>
<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Line</th>
<th align="left">Single Script App</th>
<th align="left">Modular App</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Function definition</td>
<td align="left">Not wrapped in a function</td>
<td align="left">Wrapped in <code>function(id)</code></td>
</tr>
<tr class="even">
<td align="left">Namespacing <code>(ns &lt;- NS(id))</code></td>
<td align="left">Not present</td>
<td align="left">Always present</td>
</tr>
<tr class="odd">
<td align="left">Input/output IDs</td>
<td align="left">Plain strings (e.g., “contrast”)</td>
<td align="left">Namespaced: <code>ns("contrast")</code></td>
</tr>
<tr class="even">
<td align="left">Reusability</td>
<td align="left">Only one instance possible</td>
<td align="left">Multiple, independent instances allowed</td>
</tr>
</tbody>
</table>
<p><br> <strong>2. Server Function:
<code>volcano_server</code></strong></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>volcano_server <span class="ot">&lt;-</span> <span class="cf">function</span>(id, dge_results) {</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="fu">moduleServer</span>(id, <span class="cf">function</span>(input, output, session) {</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>    <span class="fu">updateSelectInput</span>(session, <span class="st">&quot;contrast&quot;</span>, <span class="at">choices =</span> <span class="fu">names</span>(dge_results))</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    </span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    contrast <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>      <span class="fu">req</span>(input<span class="sc">$</span>contrast)</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>      dge_results[[input<span class="sc">$</span>contrast]]</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>    })</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>    </span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>    output<span class="sc">$</span>volcanoPlot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>      <span class="co"># ... plotting code using contrast()</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>    })</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>    </span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>    output<span class="sc">$</span>top_dge <span class="ot">&lt;-</span> <span class="fu">renderDT</span>({</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>      <span class="co"># ... table code using contrast()</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>    })</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>  })</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>}</span></code></pre></div>
<p>The modular approach separates the volcano plot into its own Server
function, encapsulated and namespaced for reuse and clarity.</p>
<ol style="list-style-type: decimal">
<li><code>volcano_server &lt;- function(id, dge_results) {...}</code></li>
</ol>
<ul>
<li>Defines the server logic for the volcano plot module, as a function
that takes a unique <code>id</code> (namespace) and the data
(<code>dge_results</code>).<br />
</li>
<li><strong>Difference from single-instance:</strong> In a regular app,
you would not wrap your server code in a function or require an
<code>id</code>. In a module, this function structure is essential for
instantiating the module multiple times with different namespaces or
data.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li><code>moduleServer(id, function(input, output, session) {.</code>..}</li>
</ol>
<ul>
<li>Sets up the server logic for a module, automatically scoping input,
output, and session to the module’s namespace (set by
<code>id</code>).<br />
</li>
<li><strong>Difference from single-instance:</strong> In a single-app
server, you’d just have
<code>server &lt;- function(input, output, session) { ... }</code>.
Here, <code>moduleServer()</code> ensures that all reactivity and
outputs are isolated to this module instance.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li><code>updateSelectInput(session, "contrast", choices = names(dge_results))</code></li>
</ol>
<ul>
<li>Dynamically updates the choices for the <code>"contrast"</code>
select input using the names from <code>dge_results</code>.<br />
</li>
<li><strong>Difference from single-instance:</strong> In a non-modular
app, you’d reference <code>"contrast"</code> directly and use the global
session. In a module, the session object is automatically namespaced,
and <code>"contrast"</code> refers to the input within this module
instance only.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>contrast <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>      <span class="fu">req</span>(input<span class="sc">$</span>contrast)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>      dge_results[[input<span class="sc">$</span>contrast]]</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>    })</span></code></pre></div>
<ul>
<li>Creates a reactive expression that returns the selected contrast’s
data from <code>dge_results</code>. It waits until
<code>input$contrast</code> is available.</li>
<li><strong>Difference from single-instance:</strong> In a single app,
<code>input$contrast</code> would refer to a global input. Here, it
refers only to the input for this module instance, thanks to
namespacing.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>output<span class="sc">$</span>volcanoPlot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>      <span class="co"># ... plotting code using contrast()</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>    })</span></code></pre></div>
<ul>
<li>Defines the output for the volcano plot, using the data from the
selected contrast.<br />
</li>
<li><strong>Difference from single-instance:</strong> In a single app,
you’d use <code>output$volcanoPlot</code>. In a module, this output is
automatically namespaced (e.g., <code>volcano-volcanoPlot</code> if
<code>id = "volcano"</code>), so it doesn’t conflict with other
instances.</li>
</ul>
<p><br></p>
<p><strong>Summary Table: Key Server Differences</strong></p>
<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Line/Concept</th>
<th align="left">Single Script App</th>
<th align="left">Modular App</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Function definition</td>
<td align="left">Not wrapped in a function</td>
<td align="left">Wrapped in <code>function(id, ...)</code></td>
</tr>
<tr class="even">
<td align="left">Use of <code>moduleServer()</code></td>
<td align="left">Not used</td>
<td align="left">Always used for module server logic</td>
</tr>
<tr class="odd">
<td align="left">Input/output references</td>
<td align="left">Global (e.g., <code>input$contrast</code>)</td>
<td align="left">Namespaced to module instance</td>
</tr>
<tr class="even">
<td align="left">Session object</td>
<td align="left">Global</td>
<td align="left">Namespaced to module instance</td>
</tr>
<tr class="odd">
<td align="left">Data parameterization</td>
<td align="left">Uses global variables</td>
<td align="left">Data passed as function argument
(<code>dge_results</code>)</td>
</tr>
<tr class="even">
<td align="left">Output assignment</td>
<td align="left">Global (e.g. <code>output$volcanoPlot</code>)</td>
<td align="left">Namespaced, unique to each instance</td>
</tr>
<tr class="odd">
<td align="left">Reusability</td>
<td align="left">Only one instance possible</td>
<td align="left">Multiple, independent instances allowed</td>
</tr>
</tbody>
</table>
<p><br></p>
</div>
<div id="step-4-refractor-code-for-boxplotheatmap-modules"
class="section level2">
<h2>Step 4: Refractor Code for Boxplot/Heatmap modules</h2>
<p>We repeat this process for the other two modules:</p>
<p><strong>b. Boxplot Module</strong> (<code>boxplot_mod.R</code>)</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># boxplot_mod.R</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>boxplot_ui <span class="ot">&lt;-</span> <span class="cf">function</span>(id) {</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  ns <span class="ot">&lt;-</span> <span class="fu">NS</span>(id)</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>  <span class="fu">tagList</span>(</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>    <span class="fu">selectInput</span>(<span class="fu">ns</span>(<span class="st">&quot;gene&quot;</span>), <span class="st">&quot;Select a gene to plot:&quot;</span>, <span class="at">choices =</span> <span class="cn">NULL</span>),</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>    <span class="fu">plotOutput</span>(<span class="fu">ns</span>(<span class="st">&quot;boxplot&quot;</span>))</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>  )</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>}</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>boxplot_server <span class="ot">&lt;-</span> <span class="cf">function</span>(id, deg_long, top_genes) {</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>  <span class="fu">moduleServer</span>(id, <span class="cf">function</span>(input, output, session) {</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>    <span class="fu">updateSelectInput</span>(session, <span class="st">&quot;gene&quot;</span>, <span class="at">choices =</span> top_genes<span class="sc">$</span>gene)</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>    </span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>    output<span class="sc">$</span>boxplot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>      <span class="fu">filter</span>(deg_long, Gene <span class="sc">==</span> input<span class="sc">$</span>gene) <span class="sc">%&gt;%</span> </span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>      <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Group, <span class="at">y =</span> Expression)) <span class="sc">+</span> </span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>      <span class="fu">geom_boxplot</span>() <span class="sc">+</span> </span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">15</span>)) <span class="sc">+</span> </span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>      <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">colour =</span> Group)) <span class="sc">+</span> </span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a>      <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a>            <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span> </span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Cell Type&quot;</span>, <span class="at">y=</span><span class="fu">expression</span>(<span class="st">&quot;Counts per million (log&quot;</span>[<span class="dv">2</span>]<span class="sc">*</span><span class="st">&quot;)&quot;</span>))</span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a>    })</span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a>  })</span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a>}</span></code></pre></div>
<p>Copy the boxplot module code above into a new R script and save this
in your <code>R</code> directory as <code>boxplot_mod.R</code>.</p>
<p><strong>c. Heatmap Module</strong> (<code>heatmap_mod.R</code>)</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># heatmap_mod.R</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>heatmap_ui <span class="ot">&lt;-</span> <span class="cf">function</span>(id) {</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  ns <span class="ot">&lt;-</span> <span class="fu">NS</span>(id)</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>  <span class="fu">plotOutput</span>(<span class="fu">ns</span>(<span class="st">&quot;heatmap&quot;</span>), <span class="at">height =</span> <span class="dv">800</span>)</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>}</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>heatmap_server <span class="ot">&lt;-</span> <span class="cf">function</span>(id, deg_matrix) {</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>  <span class="fu">moduleServer</span>(id, <span class="cf">function</span>(input, output, session) {</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>    </span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>    output<span class="sc">$</span>heatmap <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>      <span class="fu">pheatmap</span>(deg_matrix, <span class="at">cluster_rows =</span> <span class="cn">TRUE</span>, <span class="at">cluster_cols =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>    })</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>  })</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>}</span></code></pre></div>
<p>Copy the heatmap module code above into a new R script and save this
in your <code>R</code> directory as <code>heatmap_mod.R</code>.</p>
</div>
<div id="step-5-create-the-main-app-file" class="section level2">
<h2>Step 5: Create The Main App File</h2>
<p>It is now time to create the main app file so that we can launch our
<code>Modular dgeVis</code> app.</p>
<p>The <strong>main app file</strong> in a modular Shiny app acts as the
central hub that brings together all the modular components. It
typically contains:</p>
<ul>
<li>The overall <strong>UI definition</strong>, where you assemble the
layout and insert each module’s UI function, passing a unique namespace
ID to each instance.<br />
</li>
<li>The <strong>server function</strong>, where you call each module’s
server logic, again using the corresponding namespace ID and supplying
any needed data or parameters.<br />
</li>
<li>The call to <code>shinyApp(ui, server)</code> to launch the
app.</li>
</ul>
<p>The main app file does not contain the detailed logic or UI for each
feature—instead, it delegates these to modules, which are self-contained
units of UI and server code. By referencing modules, the main file stays
short and readable, and each feature remains isolated and reusable. The
main app file also ensures that each module instance is uniquely
identified via its namespace, preventing conflicts and enabling multiple
instances of the same module if needed.</p>
<p>Below is the code for our main app file for our Modular dgeVis
app:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># app.R</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co"># Load libraries </span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="fu">library</span>(pheatmap)</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co"># import data</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>dge_results <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">&quot;data/top.treat.results.rds&quot;</span>))</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>lcpm <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">&quot;data/lcpm.rds&quot;</span>))</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>top_genes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/top.DE.mouse.genes.csv&quot;</span>))</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co"># replace colnames with group_sample ID</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="fu">colnames</span>(lcpm) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;LP_1&quot;</span>, <span class="st">&quot;ML_1&quot;</span>, <span class="st">&quot;Basal_1&quot;</span>, <span class="st">&quot;Basal_2&quot;</span>, <span class="st">&quot;ML_2&quot;</span>, <span class="st">&quot;LP_2&quot;</span>, <span class="st">&quot;Basal_3&quot;</span>, <span class="st">&quot;ML_3&quot;</span>, <span class="st">&quot;LP_3&quot;</span>)</span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="co"># subset lcpm for DEG&#39;s</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>deg_matrix <span class="ot">&lt;-</span> lcpm[<span class="fu">rownames</span>(lcpm) <span class="sc">%in%</span> top_genes<span class="sc">$</span>gene, ]</span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a><span class="co"># pivot to long format</span></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>deg_long <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(deg_matrix) <span class="sc">%&gt;%</span></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Gene =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>Gene, <span class="at">names_to =</span> <span class="st">&quot;Sample&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;Expression&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Group =</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;LP_&quot;</span>, Sample), <span class="st">&quot;LP&quot;</span>,</span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a>                        <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;ML&quot;</span>, Sample), <span class="st">&quot;ML&quot;</span>, <span class="st">&quot;Basal&quot;</span>)))</span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Gene Expression Visualization&quot;</span>),</span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a>  <span class="fu">tabsetPanel</span>(</span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a>    <span class="fu">tabPanel</span>(<span class="st">&quot;Volcano Plot&quot;</span>, <span class="fu">volcano_ui</span>(<span class="st">&quot;volcano&quot;</span>)),</span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a>    <span class="fu">tabPanel</span>(<span class="st">&quot;Box-plots&quot;</span>, <span class="fu">boxplot_ui</span>(<span class="st">&quot;boxplot&quot;</span>)),</span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a>    <span class="fu">tabPanel</span>(<span class="st">&quot;Heatmap&quot;</span>, <span class="fu">heatmap_ui</span>(<span class="st">&quot;heatmap&quot;</span>))</span>
<span id="cb8-33"><a href="#cb8-33" tabindex="-1"></a>  )</span>
<span id="cb8-34"><a href="#cb8-34" tabindex="-1"></a>)</span>
<span id="cb8-35"><a href="#cb8-35" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb8-37"><a href="#cb8-37" tabindex="-1"></a>  <span class="fu">volcano_server</span>(<span class="st">&quot;volcano&quot;</span>, dge_results)</span>
<span id="cb8-38"><a href="#cb8-38" tabindex="-1"></a>  <span class="fu">boxplot_server</span>(<span class="st">&quot;boxplot&quot;</span>, deg_long, top_genes)</span>
<span id="cb8-39"><a href="#cb8-39" tabindex="-1"></a>  <span class="fu">heatmap_server</span>(<span class="st">&quot;heatmap&quot;</span>, deg_matrix)</span>
<span id="cb8-40"><a href="#cb8-40" tabindex="-1"></a>}</span>
<span id="cb8-41"><a href="#cb8-41" tabindex="-1"></a></span>
<span id="cb8-42"><a href="#cb8-42" tabindex="-1"></a><span class="fu">shinyApp</span>(ui, server)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Copy the complete main-app code above into the new R script.</li>
<li>Save the file with the name “app.R” within the
<code>modular_app</code> directory above the <code>R</code>
directory.</li>
</ol>
<p>Before testing, let’s break down the code in the main app:</p>
<ol style="list-style-type: decimal">
<li><strong>UI Section</strong></li>
</ol>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Gene Expression Visualization&quot;</span>),</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  <span class="fu">tabsetPanel</span>(</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>    <span class="fu">tabPanel</span>(<span class="st">&quot;Volcano Plot&quot;</span>, <span class="fu">volcano_ui</span>(<span class="st">&quot;volcano&quot;</span>)),</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>    <span class="fu">tabPanel</span>(<span class="st">&quot;Box-plots&quot;</span>, <span class="fu">boxplot_ui</span>(<span class="st">&quot;boxplot&quot;</span>)),</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>    <span class="fu">tabPanel</span>(<span class="st">&quot;Heatmap&quot;</span>, <span class="fu">heatmap_ui</span>(<span class="st">&quot;heatmap&quot;</span>))</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>  )</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>)</span></code></pre></div>
<ul>
<li><code>fluidPage(...)</code>: The top-level layout function for your
app, providing a responsive web page structure.<br />
</li>
<li><code>titlePanel("Gene Expression Visualization")</code>: Displays
the main app title at the top.<br />
</li>
<li><code>tabsetPanel(...)</code>: Creates a tabbed interface, allowing
users to switch between different visualizations.<br />
Within <code>tabsetPanel</code>:<br />
</li>
<li><code>tabPanel("Volcano Plot", volcano_ui("volcano"))</code>.
<ul>
<li>Adds a tab labeled “Volcano Plot”.<br />
</li>
<li>Calls the volcano plot module’s UI function
(<code>volcano_ui</code>) with the namespace “volcano”.<br />
</li>
</ul></li>
<li><code>tabPanel("Box-plots", boxplot_ui("boxplot"))</code>.
<ul>
<li>Adds a tab labeled “Box-plots”.<br />
</li>
<li>Calls the boxplot module’s UI function (<code>boxplot_ui</code>)
with the namespace “boxplot”.<br />
</li>
</ul></li>
<li><code>tabPanel("Heatmap", heatmap_ui("heatmap"))</code>
<ul>
<li>Adds a tab labeled “Heatmap”.</li>
<li>Calls the heatmap module’s UI function (<code>heatmap_ui</code>)
with the namespace “heatmap”.</li>
</ul></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li><strong>Server Section</strong><br />
</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  <span class="fu">volcano_server</span>(<span class="st">&quot;volcano&quot;</span>, dge_results)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  <span class="fu">boxplot_server</span>(<span class="st">&quot;boxplot&quot;</span>, deg_long, top_genes)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  <span class="fu">heatmap_server</span>(<span class="st">&quot;heatmap&quot;</span>, deg_matrix)</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li><code>server &lt;- function(input, output, session) { ... }</code>:
The main server function for your app.</li>
<li><code>volcano_server("volcano", dge_results)</code>
<ul>
<li>Initializes the volcano plot module’s server logic.<br />
</li>
<li>“volcano” is the namespace (must match the UI call).<br />
</li>
<li><code>dge_results</code> is the data passed into the module.<br />
</li>
</ul></li>
<li><code>boxplot_server("boxplot", deg_long, top_genes)</code>
<ul>
<li>Initializes the boxplot module’s server logic.<br />
</li>
<li><code>"boxplot"</code> is the namespace.<br />
</li>
<li><code>deg_long</code> and <code>top_genes</code> are the data inputs
for this module.<br />
</li>
</ul></li>
<li><code>heatmap_server("heatmap", deg_matrix)</code>
<ul>
<li>Initializes the heatmap module’s server logic.<br />
</li>
<li><code>"heatmap"</code> is the namespace.<br />
</li>
<li><code>deg_matrix</code> is the data input for this module.</li>
</ul></li>
</ul>
<p><strong>How it Works</strong>:</p>
<ul>
<li>Each <code>*_server</code> call links the UI module instance to its
server-side logic using the same namespace.<br />
</li>
<li>Data is passed directly to each module, making them self-contained
and reusable.<br />
</li>
<li>Modules operate independently, each managing its own reactivity and
outputs.</li>
</ul>
<div id="test-the-modular-app" class="section level3">
<h3>Test the Modular app</h3>
<p>Open the <code>app.R</code> file you created and click the “Run App”
button in RStudio (or use <code>shiny::runApp()</code> in the
console).</p>
<p>If you have any trouble you can also test our pre-compiled example.
Within the <code>05_shiny_module</code> directory open the file
<code>app.R</code> and click “Run App”.</p>
<p>Spend a few minutes exploring the modular app.</p>
</div>
</div>
<div id="step-6-reuse-shiny-modules" class="section level2">
<h2>Step 6: Reuse Shiny Modules</h2>
<p>We have a working Modular app which is simpler to update and modify
than our single app file. However, we haven’t yet made use of one of the
central benefits of Modular Shiny Apps, which is the ability to re-use
instances of any UI or Server logic in multiple places of a single app
(or indeed across different Shiny apps).</p>
<p>Let’s demonstrate how this works. The example below creates a second
boxplot selection and chart with our module and shows you how effortless
this task is now. No need to repeat the logic - simply call the
functions and you’re good to go:</p>
<p>Create a new R Script, copy the code below into this file and save it
as something like <code>reused-module-app.R</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># app-reused-module.R</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co"># Load libraries </span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="fu">library</span>(heatmaply)</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="co"># import data</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>dge_results <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">&quot;data/top.treat.results.rds&quot;</span>))</span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>lcpm <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">&quot;data/lcpm.rds&quot;</span>))</span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>top_genes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/top.DE.mouse.genes.csv&quot;</span>))</span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a><span class="co"># replace colnames with group_sample ID</span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="fu">colnames</span>(lcpm) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;LP_1&quot;</span>, <span class="st">&quot;ML_1&quot;</span>, <span class="st">&quot;Basal_1&quot;</span>, <span class="st">&quot;Basal_2&quot;</span>, <span class="st">&quot;ML_2&quot;</span>, <span class="st">&quot;LP_2&quot;</span>, <span class="st">&quot;Basal_3&quot;</span>, <span class="st">&quot;ML_3&quot;</span>, <span class="st">&quot;LP_3&quot;</span>)</span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="co"># subset lcpm for DEG&#39;s</span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a>deg_matrix <span class="ot">&lt;-</span> lcpm[<span class="fu">rownames</span>(lcpm) <span class="sc">%in%</span> top_genes<span class="sc">$</span>gene, ]</span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a><span class="co"># pivot to long format</span></span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a>deg_long <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(deg_matrix) <span class="sc">%&gt;%</span></span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Gene =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>Gene, <span class="at">names_to =</span> <span class="st">&quot;Sample&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;Expression&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Group =</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;LP_&quot;</span>, Sample), <span class="st">&quot;LP&quot;</span>,</span>
<span id="cb11-26"><a href="#cb11-26" tabindex="-1"></a>                        <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;ML&quot;</span>, Sample), <span class="st">&quot;ML&quot;</span>, <span class="st">&quot;Basal&quot;</span>)))</span>
<span id="cb11-27"><a href="#cb11-27" tabindex="-1"></a></span>
<span id="cb11-28"><a href="#cb11-28" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb11-29"><a href="#cb11-29" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Gene Expression Visualization&quot;</span>),</span>
<span id="cb11-30"><a href="#cb11-30" tabindex="-1"></a>  <span class="fu">tabsetPanel</span>(</span>
<span id="cb11-31"><a href="#cb11-31" tabindex="-1"></a>    <span class="fu">tabPanel</span>(<span class="st">&quot;Volcano Plot&quot;</span>, <span class="fu">volcano_ui</span>(<span class="st">&quot;volcano&quot;</span>)),</span>
<span id="cb11-32"><a href="#cb11-32" tabindex="-1"></a>    <span class="fu">tabPanel</span>(<span class="st">&quot;Box-plots&quot;</span>, </span>
<span id="cb11-33"><a href="#cb11-33" tabindex="-1"></a>             <span class="fu">boxplot_ui</span>(<span class="st">&quot;boxplot1&quot;</span>),</span>
<span id="cb11-34"><a href="#cb11-34" tabindex="-1"></a>             <span class="fu">boxplot_ui</span>(<span class="st">&quot;boxplot2&quot;</span>)),</span>
<span id="cb11-35"><a href="#cb11-35" tabindex="-1"></a>    <span class="fu">tabPanel</span>(<span class="st">&quot;Heatmap&quot;</span>, <span class="fu">heatmap_ui</span>(<span class="st">&quot;heatmap&quot;</span>))</span>
<span id="cb11-36"><a href="#cb11-36" tabindex="-1"></a>  )</span>
<span id="cb11-37"><a href="#cb11-37" tabindex="-1"></a>)</span>
<span id="cb11-38"><a href="#cb11-38" tabindex="-1"></a></span>
<span id="cb11-39"><a href="#cb11-39" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb11-40"><a href="#cb11-40" tabindex="-1"></a>  <span class="fu">volcano_server</span>(<span class="st">&quot;volcano&quot;</span>, dge_results)</span>
<span id="cb11-41"><a href="#cb11-41" tabindex="-1"></a>  <span class="fu">boxplot_server</span>(<span class="st">&quot;boxplot1&quot;</span>, deg_long, top_genes)</span>
<span id="cb11-42"><a href="#cb11-42" tabindex="-1"></a>  <span class="fu">boxplot_server</span>(<span class="st">&quot;boxplot2&quot;</span>, deg_long, <span class="fu">head</span>(top_genes))</span>
<span id="cb11-43"><a href="#cb11-43" tabindex="-1"></a>  <span class="fu">heatmap_server</span>(<span class="st">&quot;heatmap&quot;</span>, deg_matrix)</span>
<span id="cb11-44"><a href="#cb11-44" tabindex="-1"></a>}</span>
<span id="cb11-45"><a href="#cb11-45" tabindex="-1"></a></span>
<span id="cb11-46"><a href="#cb11-46" tabindex="-1"></a><span class="fu">shinyApp</span>(ui, server)</span></code></pre></div>
<p>Let’s breakdown the changes:</p>
<ol style="list-style-type: decimal">
<li><strong>Multiple calls to <code>boxplot_ui</code></strong></li>
</ol>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">tabPanel</span>(<span class="st">&quot;Box-plots&quot;</span>, </span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>         <span class="fu">boxplot_ui</span>(<span class="st">&quot;boxplot1&quot;</span>),</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>         <span class="fu">boxplot_ui</span>(<span class="st">&quot;boxplot2&quot;</span>))</span></code></pre></div>
<p><strong>Explanation</strong><br />
- You are calling <code>boxplot_ui()</code> twice within the same tab,
each time with a different namespace (<code>"boxplot1"</code> and
<code>"boxplot2"</code>).<br />
- This creates two completely independent boxplot UI components on the
same page.</p>
<p><strong>How it Works</strong><br />
- The <code>NS(id)</code> function inside <code>boxplot_ui()</code>
ensures that all input/output IDs are unique to each instance.<br />
- For example, the gene selection input for <code>boxplot1</code> is
“boxplot1-gene” and for <code>boxplot2</code> is “boxplot2-gene”.<br />
- This means users can interact with each boxplot independently.</p>
<ol start="2" style="list-style-type: decimal">
<li><strong>Multiple Calls to <code>boxplot_server()</code> with
Different Data</strong></li>
</ol>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">boxplot_server</span>(<span class="st">&quot;boxplot1&quot;</span>, deg_long, top_genes)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="fu">boxplot_server</span>(<span class="st">&quot;boxplot2&quot;</span>, deg_long, <span class="fu">head</span>(top_genes))</span></code></pre></div>
<p><strong>Explanation</strong></p>
<ul>
<li>You are initializing two separate boxplot server modules, each with
a unique namespace (<code>"boxplot1"</code>,
<code>"boxplot2"</code>).</li>
<li>The first instance (<code>boxplot1</code>) gets the full list of
genes (<code>top_genes</code>).</li>
<li>The second instance (<code>boxplot2</code>) gets only the first few
genes (<code>head(top_genes)</code>).</li>
</ul>
<p><strong>How it Works</strong></p>
<ul>
<li>Each server module operates in its own namespace and receives its
own data.<br />
</li>
<li>The <code>selectInput</code> in each UI will display only the genes
provided to that server instance.<br />
</li>
<li>The plots generated will reflect the gene selected from the
respective subset.<br />
</li>
<li>Note we have only adjusted the gene list supplied to the
<code>boxplot2</code> instance of <code>boxplot_server</code>. We could
easily have provided a completely different dataset for plotting.</li>
</ul>
<p><strong>Benefits</strong><br />
- <strong>Reusability</strong>: You only need to write the boxplot
UI/server code once, but can use it as many times as needed.<br />
- <strong>Isolation</strong>: Each instance maintains its own state;
changes in one do not affect the other.<br />
- <strong>Scalability</strong>: Adding more boxplot modules is
trivial—just add more calls with new IDs.<br />
- <strong>Flexibility</strong>: The same module can be used with
different data inputs, even within a single app.<br />
- <strong>Customizability</strong>: Each module instance can be tailored
to a specific subset or even a completely different dataset.</p>
<p>Test out the updated app (or try the example version
<code>app-reused-module.R</code> within
<code>example_apps/05_modular_app</code>).</p>
</div>
</div>
<div id="extending-the-module-concept" class="section level1">
<h1>Extending the Module Concept</h1>
<p>In this tutorial we broke down each tab of our initial Shiny app into
three separate modules, each written into a single file
(e.g. <code>boxplot_mod</code>) containing both the UI and Server code
(e.g. <code>boxplot_ui</code> and <code>boxplot_server</code>).
Alternatively, we could have structured this across six files, where
each file contained code for the UI or Server function. <strong>Why
might you do this?</strong></p>
<p>It is not necessary for the current Shiny app where each UI/Server
pair represents a self-contained portion of the app/analysis. But in a
larger Shiny app you may have a UI or Server function that performs a
stand along action you wish to repeat in multiple places of your larger
Shiny app, or re-use in a different Shiny app. In these cases,
separating your UI/Server functions may be beneficial.</p>
</div>
<div id="key-concepts-to-understand" class="section level1">
<h1>Key Concepts to Understand</h1>
<p>Using modules for your Shiny app will result in apps that are
scalable and easier to maintain. Key points to remember:</p>
<ul>
<li><strong>Namespace inputs/outputs</strong>: Always use
<code>NS(id)</code> in UI and <code>moduleServer()</code> in server
logic to prevent conflicts.<br />
</li>
<li><strong>Pass data as arguments</strong>: Supply each module with
only the data it needs, keeping modules independent.<br />
</li>
<li><strong>Organize files</strong>: Store modules in a
<code>modules/</code> or <code>R/</code> directory for clarity.<br />
</li>
<li><strong>Document modules</strong>: Add comments and documentation
for easier maintenance and reuse.</li>
</ul>
<p><br> <strong>Summary Table: Before vs. After
Modularization</strong></p>
<table>
<colgroup>
<col width="27%" />
<col width="36%" />
<col width="36%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Aspect</th>
<th align="left">Single Script App</th>
<th align="left">Modular App</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">File Structure</td>
<td align="left">One long file</td>
<td align="left">Multiple files (one per module)</td>
</tr>
<tr class="even">
<td align="left">Code Organization</td>
<td align="left">All logic together</td>
<td align="left">Self-contained UI/server per module</td>
</tr>
<tr class="odd">
<td align="left">Maintainability</td>
<td align="left">Hard to manage</td>
<td align="left">Easy to maintain and scale</td>
</tr>
<tr class="even">
<td align="left">Reusability</td>
<td align="left">Low</td>
<td align="left">High (modules can be reused)</td>
</tr>
<tr class="odd">
<td align="left">Collaboration</td>
<td align="left">Difficult</td>
<td align="left">Multiple devs can work independently</td>
</tr>
</tbody>
</table>
<p><br></p>
</div>
<div id="challenge-exercises" class="section level1">
<h1>Challenge Exercises</h1>
<p>Now that you understand the basics, try these exercises to extend the
app:</p>
<ol style="list-style-type: decimal">
<li>Try splitting each module app into separate files for
<code>*_ui</code> and <code>*_server</code>. Does the app still
function?</li>
<li>Provide an alternate set of data for the second instance of boxplot
UI and Server modules.</li>
</ol>
</div>
<div id="conclusion" class="section level1">
<h1>Conclusion</h1>
<p>In this tutorial, you’ve learned:</p>
<ol style="list-style-type: decimal">
<li>How to break a large, single-file Shiny app into smaller,
self-contained modules, each with its own UI and server logic, making
your codebase easier to organize and maintain.<br />
</li>
<li>How Shiny modules use namespacing to prevent input/output conflicts,
allowing you to safely reuse the same module multiple times within an
app or across different projects.<br />
</li>
<li>You practiced passing data and parameters to module instances,
enabling flexible and customizable components that can adapt to
different datasets or requirements.<br />
</li>
<li>You gained experience in building scalable, reusable, and testable
Shiny apps, laying the foundation for collaborative development and
easier future expansion</li>
</ol>
</div>
<div id="resources-for-further-learning" class="section level1">
<h1>Resources for Further Learning</h1>
<ul>
<li><a href="https://shiny.posit.co/r/articles/improve/modules/">Posit -
Modularizing Shiny app code</a><br />
</li>
<li><a href="https://mastering-shiny.org/scaling-modules.html">Mastering
Shiny - Shiny Modules</a><br />
</li>
<li><a
href="https://www.datanovia.com/learn/tools/shiny-apps/advanced-concepts/modules.html">Datanovia-
Shiny Modules for Scalablem Applications</a><br />
</li>
<li><a href="https://www.appsilon.com/post/r-shiny-modules">Appsilon - R
Shiny Modules</a></li>
</ul>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
